<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Music App - Auto load + Search + Infinite Scroll</title>
  <style>
    :root{
      --bg:#0f172a; --card:#0b1220; --muted:#94a3b8; --accent:#06b6d4; --text:#e6eef6;
    }
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, Arial; margin:0; background:linear-gradient(180deg,#081226, #041022); color:var(--text); min-height:100vh;}
    header{padding:18px 16px; display:flex; gap:12px; align-items:center; background:linear-gradient(180deg, rgba(6,182,212,0.03), transparent);}
    h1{font-size:18px;margin:0}
    .searchBox{flex:1; display:flex; gap:8px}
    input[type="search"]{flex:1;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06); background:#071022; color:var(--text); outline:none}
    button{padding:10px 12px;border-radius:8px;border:none;background:var(--accent); color:#012; cursor:pointer}
    main{padding:10px; padding-bottom:120px}
    .list{display:grid; grid-template-columns: repeat(auto-fill, minmax(320px,1fr)); gap:12px}
    .track{display:flex; gap:10px; align-items:center; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.02)}
    .thumb{width:72px;height:72px; border-radius:8px; object-fit:cover; background:#071226}
    .meta{flex:1; min-width:0}
    .title{font-weight:600; font-size:14px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .artist{font-size:12px; color:var(--muted); margin-top:4px}
    .right{display:flex; flex-direction:column; gap:6px; align-items:flex-end}
    .playBtn{padding:8px 10px; border-radius:8px; background:rgba(255,255,255,0.03); border:1px solid rgba(255,255,255,0.02); cursor:pointer}
    .footer-player{position:fixed; left:0; right:0; bottom:0; background:linear-gradient(180deg, rgba(0,0,0,0.6), rgba(2,6,23,0.95)); padding:10px 14px; display:flex; gap:12px; align-items:center; border-top:1px solid rgba(255,255,255,0.03)}
    .fp-thumb{width:56px;height:56px;border-radius:8px; object-fit:cover; background:#071226}
    .fp-info{flex:1; min-width:0}
    .fp-title{font-size:14px; margin:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .fp-artist{font-size:12px;color:var(--muted); margin-top:4px}
    .progress{height:6px; width:180px; background:rgba(255,255,255,0.06); border-radius:6px; overflow:hidden}
    .progress > i{display:block;height:100%; width:0%; background:var(--accent)}
    .small{font-size:12px;color:var(--muted)}
    .loader{padding:18px;text-align:center;color:var(--muted)}
    @media (max-width:520px){ .list{grid-template-columns:1fr} .progress{width:110px} .thumb{width:56px;height:56px} .fp-thumb{width:44px;height:44px} }
  </style>
</head>
<body>
  <header>
    <h1>Music App ðŸŽ§</h1>
    <div class="searchBox">
      <input id="searchInput" type="search" placeholder="à¤—à¤¾à¤¨à¤¾/à¤†à¤°à¥à¤Ÿà¤¿à¤¸à¥à¤Ÿ à¤–à¥‹à¤œà¥‡à¤‚ (enter à¤¦à¤¬à¤¾à¤à¤‚) â€” à¤¬à¤¿à¤¨à¤¾ à¤¸à¤°à¥à¤š à¤ªà¤° à¤ªà¤¹à¤²à¥‡ à¤¸à¥‡ à¤²à¤¿à¤¸à¥à¤Ÿ à¤¦à¤¿à¤–à¥‡à¤—à¥€" autocomplete="off" />
      <button id="btnClear">Clear</button>
      <button id="btnSearch">Search</button>
    </div>
  </header>

  <main>
    <div id="list" class="list" aria-live="polite"></div>
    <div id="loader" class="loader">Loading...</div>
  </main>

  <!-- Footer audio player -->
  <div class="footer-player" id="footerPlayer" style="display:none">
    <img id="fpThumb" class="fp-thumb" src="" alt="thumb" />
    <div class="fp-info">
      <div id="fpTitle" class="fp-title">Title</div>
      <div id="fpArtist" class="fp-artist">Artist</div>
      <div style="display:flex;gap:8px; align-items:center; margin-top:8px">
        <div class="progress"><i id="progressBar"></i></div>
        <div class="small" id="timePos">0:00</div>
      </div>
    </div>
    <div style="display:flex; gap:8px; align-items:center">
      <button id="btnPrev" class="playBtn">Prev</button>
      <button id="btnPlay" class="playBtn">Play</button>
      <button id="btnNext" class="playBtn">Next</button>
    </div>
  </div>

  <audio id="audioPlayer" preload="metadata"></audio>

  <script>
    /**********************************************
     * CONFIG for MusicAPI.com
     **********************************************/
    const CONFIG = {
      API_URL: 'https://api.musicapi.com/v1/public/search', // replace with your MusicAPI endpoint
      API_KEY: 'Client-ID b541a1b3-ad75-4c65-9b0e-9b1dfc6c47a2',                 // replace with your MusicAPI Key
      DEFAULT_PAGE_SIZE: 50,
      SOURCES: ['spotify','youtube','soundcloud','apple_music']
    };

    /************ state ************/
    let offset = 0;
    let pageSize = CONFIG.DEFAULT_PAGE_SIZE;
    let loading = false;
    let finished = false;
    let currentQuery = '';
    let tracks = [];
    let playingIndex = -1;

    const listEl = document.getElementById('list');
    const loaderEl = document.getElementById('loader');
    const searchInput = document.getElementById('searchInput');
    const btnSearch = document.getElementById('btnSearch');
    const btnClear = document.getElementById('btnClear');

    const audio = document.getElementById('audioPlayer');
    const footer = document.getElementById('footerPlayer');
    const fpThumb = document.getElementById('fpThumb');
    const fpTitle = document.getElementById('fpTitle');
    const fpArtist = document.getElementById('fpArtist');
    const btnPlay = document.getElementById('btnPlay');
    const btnPrev = document.getElementById('btnPrev');
    const btnNext = document.getElementById('btnNext');
    const progressBar = document.getElementById('progressBar');
    const timePos = document.getElementById('timePos');

    function fmtTime(s){ if(!s) return '0:00'; s=Math.floor(s); const m=Math.floor(s/60), sec=s%60; return m+':'+(sec<10?'0'+sec:sec); }

    function renderTrack(track, index){
      const div = document.createElement('div');
      div.className = 'track'; div.dataset.index=index;
      const thumb = document.createElement('img'); thumb.className='thumb'; thumb.alt=track.title||'thumb'; thumb.loading='lazy'; thumb.src=track.thumbnail||'https://via.placeholder.com/200x200?text=No+Image';
      const meta = document.createElement('div'); meta.className='meta';
      meta.innerHTML=`<div class="title">${escapeHtml(track.title||'Unknown title')}</div>
                      <div class="artist">${escapeHtml(track.artist||'Unknown artist')}</div>`;
      const right=document.createElement('div'); right.className='right';
      const btn=document.createElement('button'); btn.className='playBtn'; btn.textContent='Play'; btn.onclick=(e)=>{e.stopPropagation(); playAt(index)};
      right.appendChild(btn); div.appendChild(thumb); div.appendChild(meta); div.appendChild(right);
      div.addEventListener('click', ()=> playAt(index));
      return div;
    }

    function appendTracks(newTracks){
      const frag = document.createDocumentFragment();
      newTracks.forEach((t,i)=>{ frag.appendChild(renderTrack(t, tracks.length+i)); });
      listEl.appendChild(frag);
    }

    async function fetchTracks({q='', limit=pageSize, offsetParam=0}={}){
      if(loading || finished) return; loading=true; loaderEl.textContent='Loading...';
      try{
        let resJson;
        if(!CONFIG.API_URL){ resJson=mockFetch(q, limit, offsetParam); await new Promise(r=>setTimeout(r,300)); }
        else{
          const body={ track:q, type:'track', sources:CONFIG.SOURCES, limit, offset:offsetParam };
          const headers={'Content-Type':'application/json'}; if(CONFIG.API_KEY) headers['Authorization']=CONFIG.API_KEY;
          const resp = await fetch(CONFIG.API_URL,{method:'POST', headers, body:JSON.stringify(body)});
          if(!resp.ok) throw new Error('API error '+resp.status);
          resJson = await resp.json();
        }
        const items = resJson.tracks || []; // MusicAPI response
        if(items.length<limit) finished=true;
        tracks=tracks.concat(items); appendTracks(items); offset=tracks.length;
        loaderEl.style.display = finished?'none':'block';
        loaderEl.textContent = tracks.length===0?'à¤•à¥‹à¤ˆ à¤—à¤¾à¤¨à¤¾ à¤¨à¤¹à¥€à¤‚ à¤®à¤¿à¤²à¤¾':(finished?'à¤•à¥‹à¤ˆ à¤”à¤° à¤¨à¤¹à¥€à¤‚':'Scroll à¤¨à¥€à¤šà¥‡ à¤•à¤°à¤•à¥‡ à¤”à¤° à¤²à¥‹à¤¡ à¤•à¤°à¥‡à¤‚');
      } catch(err){ console.error(err); loaderEl.textContent='Error loading. Open console for details.'; }
      finally{ loading=false; }
    }

    async function doSearch(q){ currentQuery=q||''; offset=0; finished=false; tracks=[]; listEl.innerHTML=''; await fetchTracks({q:currentQuery, limit:pageSize, offsetParam:0}); window.scrollTo({top:0, behavior:'smooth'}); }

    let scrollThrottle=0;
    window.addEventListener('scroll',()=>{ if(Date.now()-scrollThrottle<200) return; scrollThrottle=Date.now(); const nearBottom=(window.innerHeight+window.scrollY)>=(document.body.offsetHeight-600); if(nearBottom && !loading && !finished) fetchTracks({q:currentQuery, limit:pageSize, offsetParam:offset}); });

    function showFooterFor(index){ const t=tracks[index]; if(!t) return; footer.style.display='flex'; fpThumb.src=t.thumbnail||'https://via.placeholder.com/200x200?text=No+Image'; fpTitle.textContent=t.title||'Unknown'; fpArtist.textContent=t.artist||'Unknown'; }

    function playAt(index){ const t=tracks[index]; if(!t||!t.stream_url){ alert('No stream URL for this track. Check API response format.'); return; } playingIndex=index; showFooterFor(index); if(audio.src!==t.stream_url) audio.src=t.stream_url; audio.play().catch(err=>console.warn('play failed', err)); btnPlay.textContent='Pause'; const card=listEl.querySelector('.track[data-index="'+index+'"]'); if(card) card.scrollIntoView({behavior:'smooth', block:'center'}); }

    btnPlay.addEventListener('click',()=>{ if(audio.paused){ audio.play().catch(()=>{}); btnPlay.textContent='Pause'; } else { audio.pause(); btnPlay.textContent='Play'; } });
    btnPrev.addEventListener('click',()=>{ if(playingIndex>0) playAt(playingIndex-1); });
    btnNext.addEventListener('click',()=>{ if(playingIndex<tracks.length-1) playAt(playingIndex+1); else if(!finished) fetchTracks({q:currentQuery, limit:pageSize, offsetParam:offset}).then(()=>playAt(playingIndex+1)); });

    audio.addEventListener('timeupdate',()=>{ const p=(audio.currentTime/(audio.duration||1))*100; progressBar.style.width=Math.max(0,Math.min(100,p))+'%'; timePos.textContent=fmtTime(audio.currentTime)+' / '+(audio.duration?fmtTime(audio.duration):'--:--'); });
    audio.addEventListener('ended',()=>{ btnPlay.textContent='Play'; if(playingIndex<tracks.length-1) playAt(playingIndex+1); });

    btnSearch.addEventListener('click',()=>doSearch(searchInput.value.trim()));
    btnClear.addEventListener('click',()=>{ searchInput.value=''; doSearch(''); });
    searchInput.addEventListener('keyup',(e)=>{ if(e.key==='Enter') doSearch(searchInput.value.trim()); });

    (async function init(){ await fetchTracks({q:'', limit:pageSize, offsetParam:0}); })();

    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, (m)=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

    function mockFetch(q,limit,offset){ const total=1000; const items=[]; for(let i=0;i<limit;i++){ const idx=offset+i+1; if(idx>total) break; const title=q?`Result for "${q}" #${idx}`:`Sample Track #${idx}`; items.push({id:'mock-'+idx,title,artist:'Demo Artist '+((idx%10)+1),thumbnail:`https://picsum.photos/seed/music${idx}/200/200`,stream_url:'https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3',durationSeconds:240}); } return {tracks:items,total}; }
  </script>
</body>
</html>
